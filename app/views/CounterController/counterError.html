#{extends 'main.html' /}
#{set title:'Depositar Efectivo' /}
<section id="counterError">
    <header></header>
    <article>
        #{if ( merror?.isError() ) }
        <h1 class="">&{ 'application.error' }</h1>
        #{/if}
        #{else}
        <h1 class="">&{ 'application.ok' }</h1>
        #{/else}
        <div class="contenido">
            #{if ( merror?.isError() ) }
            #{if ( controllers.Secure.checkPermission( 'Application.reset', 'GET' ) || controllers.Secure.checkPermission( 'Application.storingReset', 'GET' ) ) }
            #{if merror?.isError() }
            #{if merror.getGloryError() }
            <h2>GLORY ERROR : ${ merror.getGloryError() }</h2>
            #{/if}
            #{if merror.getPrinterError() }
            <h2>PRINTER ERROR : ${ merror.getPrinterError() }</h2>
            #{/if}
            #{if merror.getIoBoardError() }
            <h2>IOBOARD ERROR : ${ merror.getIoBoardError() }</h2>
            #{/if}
            #{if merror.getErrorCode() }
            <h2>APLICATION ERROR : code ${ merror.getErrorCode() }
                #{if merror.getDetail() } detail : ${ merror.getDetail() }#{/if}
            </h2>
            #{/if}
            #{/if}
            #{else}
            <b class="">&{ 'application.ok' }</b>
            #{/else}

            <!--            <p id="mstatus">ModelFacade status ${ mstatus }</p>
                        <p id="gstatus">Glory Status ${ gstatus }</p>
                        <p id="gerror">Glory Error ${ gError }</p>
                        <p id="ierror">IOBoard Status ${ istatus }</p>
                        <p id="ierror">IOBoard Error ${ ierror }</p>
            -->
            <a class="boton ${play.configuration['style.button_color']} full_width" href="@{counterError(1)}">Reset</a>
            <a class="boton ${play.configuration['style.button_color']} full_width" href="@{counterError(2)}">StoringErrorReset</a>
            <!-- datos del deposito -->
            <!-- /datos del deposito -->
            #{/if}
            #{else}
            <h2>&{ 'application.hardware_error' }</h2>
            #{/else}
            #{/if}
        </div>
        <hr />
        <div class="botonera">
            <ul class="on-2 columns">
                <li class="column">
                    <div class="columna">
                        <!-- link cancelar -->
                        <!--                    #{if isError }
                                            <a href="@{counterError()}" class="boton gris">Refresh</a>
                                            #{/if}
                                            #{else}
                                            #{/else}-->
                        <a href="@{Application.index()}" class="boton gris full_width">&{ 'main_menu.title' }</a>
                    </div>
                </li>
                <li class="column">
                    <div class="columna">
                        #{if ( controllers.Secure.getCurrentUser() != null && ! controllers.Secure.getCurrentUser().isGuest() ) }
                        <a href="@{ Secure.logout( "Application.index" ) }" class="boton verde full_width">&{'main_menu.logout'}</a>
                        #{/if}
                        #{else}
                        <a href="@{ Secure.login}" class="boton verde full_width">&{'main_menu.login'}</a>
                        #{/else}
                    </div>
                </li>
            </ul>
        </div>
    </article>
</section>



#{set 'moreScripts'}
<script type="text/javascript" charset="${_response_encoding}">
    var waiting = false;
    
    // Reload the whole messages panel
    function refresh() {
        if ( waiting ) {
            return;
        }
        waiting = true;
        $.getJSON( '@{counterError}', function( data ) {
            waiting = false;
            //$( '#gstatus' ).html(  data[ 0 ] );
            //$( '#gerror' ).html(  data[ 1 ] );
        });
    }
    // Call refresh every 1.5 seconds
    //setInterval(refresh, 1500);
    //refresh();
</script>
#{/set}
